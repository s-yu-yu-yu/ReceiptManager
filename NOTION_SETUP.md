# Notion連携セットアップガイド

## 1. Notion APIキーの取得

1. [Notion Integrations](https://www.notion.so/my-integrations) にアクセス
2. 「新しいインテグレーション」をクリック
3. 以下の情報を入力:
   - 名前: Receipt Manager
   - ワークスペース: 使用するワークスペースを選択
   - タイプ: Internal
4. 「送信」をクリック
5. 表示される「Internal Integration Token」をコピー

## 2. Notionデータベースの作成

### レシートデータベース

1. Notionで新しいページを作成
2. データベースを選択（フルページ）
3. 以下のプロパティを追加:

| プロパティ名 | タイプ | 説明 |
|------------|-------|------|
| 店舗名 | タイトル | レシートの店舗名 |
| 日付 | 日付 | 購入日 |
| 合計金額 | 数値 | レシート合計金額 |
| レシートID | テキスト | ローカルDBのID |
| 作成日時 | 日付 | レコード作成日時 |
| 更新日時 | 日付 | レコード更新日時 |

### 商品アイテムデータベース（オプション）

1. 別のデータベースを作成
2. 以下のプロパティを追加:

| プロパティ名 | タイプ | 説明 |
|------------|-------|------|
| 商品名 | タイトル | 商品の名前 |
| 数量 | 数値 | 購入数量 |
| 単価 | 数値 | 商品単価 |
| 合計 | 数値 | 商品合計金額 |
| カテゴリ | セレクト | 商品カテゴリ |
| レシート | リレーション | レシートDBへの参照 |

## 3. データベースへのアクセス権限設定

1. 作成したデータベースページの右上「...」メニューをクリック
2. 「接続」をクリック
3. 作成したインテグレーション（Receipt Manager）を検索して追加

## 4. データベースIDの取得

1. データベースページのURLをコピー
2. URLから以下の部分を抽出:
   ```
   https://www.notion.so/workspace-name/データベースID?v=xxx
   ```
   データベースIDは32文字の英数字

## 5. 環境変数の設定

`.env.local`ファイルに以下を設定:

```env
VITE_NOTION_API_KEY=取得したAPIキー
VITE_NOTION_RECEIPTS_DATABASE_ID=レシートデータベースID
```

## 6. 接続確認

設定画面のNotion連携セクションで「接続テスト」を実行して確認

## トラブルシューティング

### エラー: "Notion APIキーが設定されていません"
- `.env.local`ファイルが正しく設定されているか確認
- 開発サーバーを再起動（`bun run dev`）

### エラー: "Database not found"
- データベースIDが正しいか確認
- インテグレーションがデータベースに接続されているか確認

### エラー: "Unauthorized"
- APIキーが正しいか確認
- インテグレーションが有効か確認