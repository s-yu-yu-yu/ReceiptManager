# 食費管理アプリ開発計画書

## 1. プロジェクト概要

### 目的

自炊の出費を管理し、使いすぎの品目を把握して食費削減とモチベーション向上を図る個人用 Web アプリケーション

### 主要機能

- レシート画像からの自動データ抽出
- 品目別・期間別の支出分析
- Notion 連携による外部データ管理

## 2. 機能要件

### コア機能

1. **レシート読み取り機能**

   - カメラ/画像アップロードによるレシート撮影
   - Gemini AI API を使用した品目・金額の自動抽出
   - 読み取り結果の編集・修正機能

2. **データ管理機能**

   - 購入日、店舗名、品目、金額の記録
   - データの追加・編集・削除
   - ローカルストレージ/IndexedDB によるデータ保存

3. **分析・表示機能**
   - 週次・月次の支出サマリー
   - 品目別支出ランキング
   - 支出推移グラフ

### オプション機能

- Notion API によるデータ同期
- CSV エクスポート機能
- 予算設定・アラート機能

## 3. 技術スタック

### フロントエンド

- **フレームワーク**: React (Vite)
- **UI ライブラリ**: Tailwind CSS + shadcn/ui
- **状態管理**: Zustand
- **グラフ**: Recharts
- **カメラ**: react-webcam

### データ管理

- **ローカル DB**: IndexedDB (Dexie.js)
- **外部連携**: Notion API

### AI/画像処理

- **OCR**: Gemini AI API (構造化出力)
- **画像処理**: Canvas API

## 4. データモデル

```typescript
interface Receipt {
  id: string;
  date: Date;
  storeName: string;
  items: ReceiptItem[];
  totalAmount: number;
  imageUrl?: string;
  createdAt: Date;
  updatedAt: Date;
}

interface ReceiptItem {
  id: string;
  name: string;
  category?: string;
  quantity: number;
  unitPrice: number;
  totalPrice: number;
}

interface Category {
  id: string;
  name: string;
  color: string;
}
```

## 5. 画面構成（モバイルファースト設計）

### ホーム画面

**レイアウト**: 縦スクロール

- **ヘッダー**:
  - 今月の合計額（大きく表示）
  - 前月比インジケーター
- **本日の支出**: カード形式
- **最近のレシート**: 3 件表示 + もっと見るリンク
- **FAB**: レシート追加ボタン（右下固定）

### レシート撮影画面

**レイアウト**: フルスクリーン

- **カメラビュー**: 画面の 80%
- **下部コントロール**:
  - 撮影ボタン（中央・大きめ）
  - ギャラリーから選択（左）
  - フラッシュ切替（右）
- **ガイド枠**: レシートの位置合わせ用

### 読み取り結果確認画面

**レイアウト**: 縦スクロール + 固定フッター

- **上部**: 撮影したレシート画像（縮小表示）
- **中部**:
  - 店舗名・日付（編集可能）
  - 品目リスト（スワイプで削除）
  - 品目追加ボタン
- **下部固定**:
  - 合計金額
  - キャンセル / 保存ボタン

### 分析画面

**レイアウト**: タブ切替式

- **タブ**: 週 / 月 / 年
- **サマリーカード**:
  - 期間合計
  - 1 日平均
  - 最多支出日
- **グラフエリア**:
  - 横スクロール可能な棒グラフ
  - タップで詳細表示
- **カテゴリ別**:
  - 横棒グラフ（金額表示）
  - パーセンテージ表示

### レシート一覧画面

**レイアウト**: 無限スクロール

- **検索バー**: 固定ヘッダー
- **フィルター**:
  - 期間（プルダウン）
  - カテゴリ（チップス）
- **リストアイテム**:
  - 日付・店舗名
  - 合計金額（右寄せ・太字）
  - 主要品目 3 つまで表示

### 底部ナビゲーション（固定）

- ホーム（アイコン: Home）
- 分析（アイコン: BarChart）
- 履歴（アイコン: Receipt）
- 設定（アイコン: Settings）

### 設定画面

**レイアウト**: リスト形式

- **データ管理**:
  - Notion 連携（トグル + 設定）
  - CSV エクスポート
  - データクリア
- **表示設定**:
  - ダークモード
  - 通貨表示
- **カテゴリ管理**:
  - カテゴリ一覧
  - 新規追加

### UI/UX 考慮事項

- **タッチターゲット**: 最小 44×44px
- **片手操作**: 重要なボタンは画面下部に配置
- **スワイプジェスチャー**:
  - 左スワイプで削除
  - 下スワイプで更新
- **ローディング**: スケルトンスクリーン使用
- **オフライン対応**: 基本機能は通信なしで利用可能

## 6. 開発スケジュール

### Phase 1: 基本機能実装（2 週間）

- [ ] プロジェクトセットアップ
- [ ] 基本 UI 構築
- [ ] IndexedDB セットアップ
- [ ] レシート手動入力機能

### Phase 2: AI 連携（1 週間）

- [ ] Gemini AI API 統合
- [ ] カメラ機能実装
- [ ] レシート読み取り処理

### Phase 3: 分析機能（1 週間）

- [ ] グラフ表示機能
- [ ] 統計計算ロジック
- [ ] フィルタリング機能

### Phase 4: 拡張機能（1 週間）

- [ ] Notion API 連携
- [ ] エクスポート機能
- [ ] UI 改善・バグ修正

## 7. Gemini AI API 実装詳細

### API キー管理

- 環境変数での管理（.env.local）
- クライアントサイドでの使用注意

### レシート読み取りプロンプト

```javascript
const schema = {
  type: "object",
  properties: {
    storeName: { type: "string" },
    date: { type: "string", format: "date" },
    items: {
      type: "array",
      items: {
        type: "object",
        properties: {
          name: { type: "string" },
          quantity: { type: "number" },
          unitPrice: { type: "number" },
          totalPrice: { type: "number" },
        },
      },
    },
    totalAmount: { type: "number" },
  },
};
```

## 8. セキュリティ考慮事項

- API キーのクライアントサイド露出対策
- 個人用アプリのためベーシック認証で十分
- HTTPS でのホスティング必須

## 9. デプロイ方法

### 推奨プラットフォーム

- Vercel（無料枠で十分）
- Netlify
- GitHub Pages（静的サイト）

### 環境変数設定

- VITE_GEMINI_API_KEY
- VITE_NOTION_API_KEY（オプション）

## 10. 今後の拡張案

- 複数ユーザー対応（家族共有）
- 予算管理・アラート機能
- レシピ提案機能（購入履歴から）
- バーコードスキャン機能
- 店舗別価格比較
